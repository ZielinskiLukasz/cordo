#!/usr/bin/env php
<?php

/**
 * Handling console script execution
 */

use App\Loader;
use Whoops\Run;
use Symfony\Component\Dotenv\Dotenv;
use Whoops\Handler\PlainTextHandler;
use Symfony\Component\Console\Application;
use System\Application\Error\Handler\PrettyErrorHandler;

require __DIR__.'/bootstrap/autoload.php';

$dotenv = new Dotenv();
$dotenv->load(root_path().'.env');

// pretty errors
$whoops = new Run;
$whoops->pushHandler(new PlainTextHandler);

$errorReporter = require_once __DIR__.'/bootstrap/error.php';
$errorReporter->pushHandler(new PrettyErrorHandler($whoops));

try {
    // bootstapping
    $container = require_once __DIR__.'/bootstrap/app.php';

    $application = new Application();
    Loader::loadCommands($application, $container);
    $application->run();
} catch (Error | Exception $e) {
    $errorReporter->report($e);
}
